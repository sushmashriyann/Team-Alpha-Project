<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title>Reset Password</title>
</head>
<body>
    <div id="passwordResetModal" class="modal" role="dialog" aria-labelledby="passwordResetModalTitle" aria-modal="true">
        <div class="modal-content">
            <h2 id="passwordResetModalTitle">Reset Password</h2>
            <form id="resetPasswordForm" method="POST" onsubmit="handleSubmit(event)">
                <input type="hidden" name="token" value="{{ token }}">
                <input type="password" id="new_password" name="new_password" placeholder="New Password"><br><br>
                <button type="submit">Submit</button>
            </form>
            <div id="message" style="display:none;"></div>
        </div>
    </div>

    <script>
        const modal = document.getElementById("passwordResetModal");

        window.onload = () => {
            modal.style.display = "block";
        };

        async function handleSubmit(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const token = formData.get('token');
            const newPassword = formData.get('new_password');

            try {
                const response = await fetch('/reset-password', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                
                if (response.ok) {
                    alert(result.message || "Password has been reset successfully!");
                    // window.location.href = '/'; // Redirect to home page after success
                    window.close(); // Close the window after success

                } else {
                    alert(result.error || "An error occurred!");
                }
            } catch (error) {
                console.error('Error resetting password:', error);
                alert("An error occurred while resetting the password.");
            }
        }
    </script>
</body>
</html>
